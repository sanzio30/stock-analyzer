<!-- templates/index.html -->
{% extends "base.html" %}

{% block title %}Fundamental Stock Analyzer{% endblock %}

{% block content %}

<div class="row justify-content-center">
    <div class="col-md-8">

        <div class="card shadow-sm mb-4">
            <div class="card-body">
                <h4 class="card-title mb-3">Analisa Fundamental Saham Global</h4>
                <form method="post" class="row g-3">
                    <div class="col-md-8">
                        <label for="ticker" class="form-label">Kode Saham</label>
                        <input type="text"
                               class="form-control"
                               id="ticker"
                               name="ticker"
                               placeholder="contoh: BBCA, BBRI, ANTM, AAPL, 7203.T"
                               value="{{ ticker_input }}">
                        <div class="form-text">
                            • Indonesia cukup tulis: BBCA, BBRI, ANTM (script akan auto .JK)<br>
                            • US: AAPL, MSFT, TSLA<br>
                            • Jepang: 7203.T, dsb.
                        </div>
                    </div>
                    <div class="col-md-4 d-flex align-items-end">
                        <button type="submit" class="btn btn-primary w-100">
                            Analisa
                        </button>
                    </div>
                </form>

                {% if error_msg %}
                    <div class="alert alert-danger mt-3">
                        {{ error_msg }}
                    </div>
                {% endif %}
            </div>
        </div>

        {% if result %}
            <div class="card shadow-sm">
                <div class="card-body">
                    <h5 class="card-title">
                        {{ result.name or result.used_ticker }}
                        <small class="text-muted">
                            ({{ result.input_ticker }} → {{ result.used_ticker }})
                        </small>
                    </h5>
                    <p class="mb-1">
                        <strong>Sector:</strong> {{ result.sector or '-' }}<br>
                        <strong>Industry:</strong> {{ result.industry or '-' }}<br>
                        <strong>Currency:</strong> {{ result.currency or '-' }}
                    </p>
                    <hr>

                    <div class="row">
                        <div class="col-md-6">
                            <h6>Size & Valuasi</h6>
                            <table class="table table-sm table-bordered align-middle">
                                <tbody>
                                <tr>
                                    <th scope="row">Price</th>
                                    <td>{{ result.price_str or '-' }}</td>
                                </tr>
                                <tr>
                                    <th scope="row">Market Cap</th>
                                    <td>{{ result.market_cap_str or '-' }}</td>
                                </tr>
                                <tr>
                                    <th scope="row">Shares Outstanding</th>
                                    <td>{{ result.shares_out_str or '-' }}</td>
                                </tr>
                                </tbody>
                            </table>
                        </div>

                        <div class="col-md-6">
                            <h6>Key Ratios</h6>
                            <table class="table table-sm table-bordered align-middle">
                                <tbody>
                                <tr>
                                    <th scope="row">PER</th>
                                    <td>{{ result.ratios.PER_str or 'N/A' }}</td>
                                </tr>
                                <tr>
                                    <th scope="row">PBV</th>
                                    <td>{{ result.ratios.PBV_str or 'N/A' }}</td>
                                </tr>
                                <tr>
                                    <th scope="row">ROE (%)</th>
                                    <td>{{ result.ratios.ROE_str or 'N/A' }}</td>
                                </tr>
                                <tr>
                                    <th scope="row">DER</th>
                                    <td>{{ result.ratios.DER_str or 'N/A' }}</td>
                                </tr>
                                <tr>
                                    <th scope="row">Dividend Yield (%)</th>
                                    <td>{{ result.ratios.DividendYield_str or 'N/A' }}</td>
                                </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <h6 class="mt-3">Growth (Net Income)</h6>
                    {% if result.growth_list %}
                        <table class="table table-sm table-bordered align-middle">
                            <thead>
                            <tr>
                                <th>Periode</th>
                                <th>Net Income</th>
                            </tr>
                            </thead>
                            <tbody>
                            {% for item in result.growth_list %}
                                <tr>
                                    <td>{{ item.period }}</td>
                                    <td>{{ item.value_str }}</td>
                                </tr>
                            {% endfor %}
                            </tbody>
                        </table>
                        <p class="mb-0">
                            <strong>CAGR Net Income (approx):</strong>
                            {% if result.growth_cagr_str %}
                                {{ result.growth_cagr_str }}% / tahun
                            {% else %}
                                N/A
                            {% endif %}
                        </p>
                    {% else %}
                        <p class="text-muted">Data Net Income tidak tersedia / gagal diambil.</p>
                    {% endif %}

                    <p class="text-muted small mt-3">
                        Catatan: Data diambil dari yfinance (Yahoo Finance).  
                        Selalu kombinasikan dengan analisa kualitatif, laporan keuangan resmi, dan berita terbaru.
                    </p>
                </div>
            </div>
        {% endif %}

    </div>
</div>

{% endblock %}
